<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Login - Tourist Registration System</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåç Tourist Login</h1>
            <a href="index.html" class="back-link">‚Üê Back to Home</a>
        </header>

        <main class="login-content">
            <div class="login-box">
                <h2>Access Your Dashboard</h2>
                <p class="subtitle">Enter your unique ID to access your tourist profile</p>

                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="uniqueId">Enter Your Unique ID</label>
                        <input 
                            type="text" 
                            id="uniqueId" 
                            name="uniqueId" 
                            placeholder="e.g., 7 to 10 alphanumeric characters (A-Za-z0-9)"
                            required
                            style="font-size: 16px; padding: 12px;"
                        >
                        <small style="color: #666; display: block; margin-top: 5px;">
                            Your Unique ID was provided when you registered
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        üîì Login to Dashboard
                    </button>
                    
                    <p id="loginStatus" class="status-text" style="margin-top: 15px;"></p>
                </form>

                <div class="help-section">
                    <p>Don't have an account? <a href="register.html">Register here</a></p>
                    <p class="help-text">üí° Lost your Unique ID? Contact support for recovery.</p>
                    <p class="help-text"><a href="mailto:tech.pheonix03@gmail.com">üìß Email: support@VikrantaTouristry.com</a></p>
                </div>
            </div>

            <div class="info-panel">
                <h3>What You Can Do</h3>
                <ul>
                    <li>‚úì View your registration status</li>
                    <li>‚úì Upload required documents</li>
                    <li>‚úì Track verification progress</li>
                    <li>‚úì Download your digital PVC card</li>
                    <li>‚úì Access your QR code</li>
                </ul>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 Tourist Registration Blockchain System</p>
        </footer>
    </div>

    <script>
        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const uniqueId = document.getElementById('uniqueId').value.trim();
            const statusElement = document.getElementById('loginStatus');
            const submitButton = e.target.querySelector('button[type="submit"]');
            
            if (!uniqueId) {
                statusElement.textContent = '‚ö†Ô∏è Please enter your Unique ID';
                statusElement.style.color = '#ef4444';
                return;
            }
            
            // Validate unique ID format (7-10 alphanumeric characters)
            const idRegex = /^[A-Za-z0-9]{7,10}$/;
            if (!idRegex.test(uniqueId)) {
                statusElement.textContent = '‚ö†Ô∏è Invalid Unique ID format. Use 7-10 alphanumeric characters.';
                statusElement.style.color = '#ef4444';
                return;
            }
            
            // Show loading
            submitButton.disabled = true;
            submitButton.textContent = 'Verifying...';
            statusElement.textContent = 'üîç Checking your registration...';
            statusElement.style.color = '#3b82f6';
            
            try {
                // Verify the tourist exists in the system
                const response = await fetch(`/api/tourist/info/${uniqueId}`);
                const result = await response.json();
                
                if (result.success && result.data && result.data.name) {
                    // Tourist exists, redirect to dashboard
                    statusElement.textContent = '‚úÖ Login successful! Redirecting...';
                    statusElement.style.color = '#10b981';
                    
                    // Store uniqueId in sessionStorage for the dashboard
                    sessionStorage.setItem('touristUniqueId', uniqueId);
                    sessionStorage.setItem('touristName', result.data.name);
                    
                    setTimeout(() => {
                        window.location.href = `dashboard.html?uniqueId=${uniqueId}`;
                    }, 1000);
                } else {
                    // Tourist not found
                    statusElement.textContent = '‚ùå Tourist ID not found. Please check your ID or register first.';
                    statusElement.style.color = '#ef4444';
                    submitButton.disabled = false;
                    submitButton.textContent = 'üîì Login to Dashboard';
                }
            } catch (error) {
                console.error('Login error:', error);
                statusElement.textContent = '‚ùå Error connecting to server. Please try again.';
                statusElement.style.color = '#ef4444';
                submitButton.disabled = false;
                submitButton.textContent = 'üîì Login to Dashboard';
            }
        });
        
        // Auto-fill if uniqueId is in URL
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const uniqueId = urlParams.get('uniqueId');
            if (uniqueId) {
                document.getElementById('uniqueId').value = uniqueId;
            }
        });
    </script>
</body>
</html>
